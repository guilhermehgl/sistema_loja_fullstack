<div class="modal-backdrop">
  <div class="modal-box modal-box--large">

    <div class="modal-box__header">
      <h2 class="modal-box__title">Venda</h2>
      <button class="modal-close" (click)="close.emit()">Ã—</button>
    </div>

    <input 
      class="modal-input modal-input--search" 
      [(ngModel)]="search" 
      (input)="filter()" 
      placeholder="Buscar produto..." 
    />

    <div class="sale-list">
      <div class="sale-item" *ngFor="let p of visibleProducts">
        <span class="sale-text">
          {{ p.name }} - R$ {{ p.price | number:'1.2-2' }}
        </span>
        <button 
          class="btn btn--primary" 
          (click)="add(p)" 
          [disabled]="!canAddProduct(p) || p.quantity <= 0">
          Adicionar
        </button>
      </div>
    </div>

    <div class="sale-cart" *ngIf="cart.length">

      <div class="sale-cart-item" *ngFor="let item of cart">

        <div class="sale-cart-row">
          <span class="sale-text">{{ item.name }}</span>

          <div class="sale-qty">
            <button class="btn btn--secondary" (click)="dec(item)">-</button>
            <input 
              class="modal-input modal-input--qty"
              type="number" 
              [value]="item.quantity" 
              (input)="onQuantityInput($event, item)"
              (blur)="onQuantityBlur(item)" 
              (keydown)="blockInvalidKeys($event)" 
            />
            <button class="btn btn--secondary" (click)="inc(item)" [disabled]="!canIncrease(item)">+</button>
          </div>
        </div>

        <div class="modal-error" *ngIf="item.quantity >= item.stock">
          Limite de estoque atingido
        </div>

      </div>

      <div class="sale-total">
        Total: R$ {{ total | number:'1.2-2' }}
      </div>

    </div>

    <div class="modal-footer">
      <button class="btn btn--secondary" (click)="close.emit()">Cancelar</button>
      <button class="btn btn--primary" (click)="finalize()" [disabled]="loading || !cart.length">
        {{ loading ? 'Vendendo...' : 'Finalizar venda' }}
      </button>
    </div>

  </div>
</div>
