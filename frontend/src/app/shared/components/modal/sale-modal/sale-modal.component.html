<app-base-modal
  [title]="'Venda'"
  [showCancel]="true"
  (cancel)="close.emit()"
  class="sale-modal-wrapper"
>

  <div class="sale-modal">

    <input
      class="sale-modal__search"
      [(ngModel)]="search"
      (input)="filter()"
      placeholder="Buscar produto..."
    />

    <div class="sale-modal__list">

      <div class="sale-modal__item" *ngFor="let p of visibleProducts">

        <span class="sale-modal__item-text">
          {{ p.name }} - R$ {{ p.price | number:'1.2-2' }}
        </span>

        <button
          type="button"
          class="btn btn--primary sale-modal__btn-add"
          (click)="add(p)"
          [disabled]="!canAddProduct(p) || p.quantity <= 0"
        >
          Adicionar
        </button>

      </div>

    </div>

    <div class="sale-modal__cart" *ngIf="cart.length">

      <div class="sale-modal__cart-item" *ngFor="let item of cart">

        <div class="sale-modal__cart-row">

          <span class="sale-modal__cart-name">
            {{ item.name }}
          </span>

          <div class="sale-modal__qty">

            <button
              type="button"
              class="btn btn--secondary sale-modal__qty-btn"
              (click)="dec(item)"
            >
              -
            </button>

            <input
              class="sale-modal__qty-input"
              type="number"
              [value]="item.quantity"
              (input)="onQuantityInput($event, item)"
              (blur)="onQuantityBlur(item)"
              (keydown)="blockInvalidKeys($event)"
            />

            <button
              type="button"
              class="btn btn--secondary sale-modal__qty-btn"
              (click)="inc(item)"
              [disabled]="!canIncrease(item)"
            >
              +
            </button>

          </div>

        </div>

        <p class="sale-modal__stock-error" *ngIf="item.quantity >= item.stock">
          Limite de estoque atingido
        </p>

      </div>

      <div class="sale-modal__total">
        Total: <strong>R$ {{ total | number:'1.2-2' }}</strong>
      </div>

    </div>

  </div>

  <button
    modal-actions
    type="button"
    class="btn btn--primary modal-box__btn"
    (click)="finalize()"
    [disabled]="loading || !cart.length"
  >
    {{ loading ? 'Vendendo...' : 'Finalizar venda' }}
  </button>

</app-base-modal>
